<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“š ë™í™”ì±… ì„¸ìƒ</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š ì¬ë¯¸ìˆëŠ” ë™í™”ì±… ì„¸ìƒ</h1>
            <p>ì‹ ë‚˜ëŠ” ì´ì•¼ê¸°ê°€ ê°€ë“í•œ ë™í™”ì±…ì„ ë§Œë‚˜ë³´ì„¸ìš”!</p>
        </div>

        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div style="display: flex; gap: 10px; align-items: center;">
                <select id="ageFilter" class="form-control" style="width: auto; padding: 10px;">
                    <option value="">ì „ì²´ ì—°ë ¹</option>
                    <option value="3-5ì„¸">3-5ì„¸</option>
                    <option value="5-7ì„¸">5-7ì„¸</option>
                    <option value="4-6ì„¸">4-6ì„¸</option>
                </select>
                <input 
                    type="text" 
                    id="searchInput" 
                    class="form-control" 
                    placeholder="ğŸ” ì œëª©ì´ë‚˜ ì‘ê°€ë¡œ ê²€ìƒ‰..." 
                    style="width: 300px; padding: 10px;"
                >
            </div>
            <a href="/admin" class="btn btn-secondary">âš™ï¸ ê´€ë¦¬ì í˜ì´ì§€</a>
        </div>

        <div id="storybookList" class="card-grid">
            <div class="loading">ë™í™”ì±…ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤</div>
        </div>
    </div>

    <script src="/js/main.js"></script>
    <script>
        let allStorybooks = [];

        // ë™í™”ì±… ëª©ë¡ ë¡œë“œ
        async function loadStorybooks() {
            try {
                const response = await fetch('/api/storybooks');
                const data = await response.json();
                allStorybooks = data.storybooks.filter(s => s.isPublished);
                displayStorybooks(allStorybooks);
            } catch (error) {
                document.getElementById('storybookList').innerHTML = 
                    '<div class="loading" style="color: #E57373;">ë™í™”ì±…ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤ ğŸ˜¢</div>';
            }
        }

        // ë™í™”ì±… í‘œì‹œ
        function displayStorybooks(storybooks) {
            const container = document.getElementById('storybookList');
            
            if (storybooks.length === 0) {
                container.innerHTML = '<div class="loading">ë“±ë¡ëœ ë™í™”ì±…ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            container.innerHTML = storybooks.map(story => `
                <div class="card" onclick="openStorybook('${story.id}')">
                    <img 
                        src="${story.coverImageUrl || 'https://via.placeholder.com/400x300?text=No+Image'}" 
                        alt="${story.title}"
                        class="card-image"
                        onerror="this.src='https://via.placeholder.com/400x300?text=No+Image'"
                    >
                    <div class="card-content">
                        <h3 class="card-title">${story.title}</h3>
                        <p class="card-author">âœï¸ ${story.author || 'ì‘ê°€ ë¯¸ìƒ'}</p>
                        <div class="card-meta">
                            <span>ğŸ¯ ${story.ageGroup || 'ì „ì²´'}</span>
                            <span>ğŸ“„ ${story.pageCount}í˜ì´ì§€</span>
                        </div>
                        <div class="tags">
                            ${story.tags.map(tag => `<span class="tag">#${tag}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ë™í™”ì±… ì—´ê¸°
        function openStorybook(id) {
            window.location.href = `/reader/${id}`;
        }

        // í•„í„°ë§
        function filterStorybooks() {
            const ageFilter = document.getElementById('ageFilter').value;
            const searchQuery = document.getElementById('searchInput').value.toLowerCase();

            let filtered = allStorybooks;

            // ì—°ë ¹ëŒ€ í•„í„°
            if (ageFilter) {
                filtered = filtered.filter(s => s.ageGroup === ageFilter);
            }

            // ê²€ìƒ‰ í•„í„°
            if (searchQuery) {
                filtered = filtered.filter(s => 
                    s.title.toLowerCase().includes(searchQuery) ||
                    (s.author && s.author.toLowerCase().includes(searchQuery))
                );
            }

            displayStorybooks(filtered);
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('ageFilter').addEventListener('change', filterStorybooks);
        document.getElementById('searchInput').addEventListener('input', filterStorybooks);

        // ì´ˆê¸° ë¡œë“œ
        loadStorybooks();
    </script>
</body>
</html>
